# دليل استخدام مواعيد العمل

## الميزات المضافة

### 1. خدمة الوقت من السيرفر الخارجي
- **الملف**: `lib/services/time_service.dart`
- **الوظيفة**: الحصول على الوقت الحالي من سيرفر خارجي بدلاً من ساعة الجهاز
- **المصادر المستخدمة**:
  - WorldTimeAPI (الخيار الأساسي)
  - TimeAPI (الخيار الاحتياطي)
- **الاستخدام**:
```dart
// الحصول على الوقت الحالي
DateTime currentTime = await TimeService.getCurrentTime();

// الحصول على الوقت مع التحقق من الصحة
DateTime validatedTime = await TimeService.getValidatedTime();

// التحقق من صحة الوقت
bool isValid = await TimeService.isTimeValid();
```

### 2. نموذج بيانات مواعيد العمل
- **الملف**: `lib/markets/models/working_hours.dart`
- **المكونات**:
  - `WorkingHours`: ساعات عمل يوم واحد
  - `WeeklyWorkingHours`: ساعات العمل الأسبوعية

#### خصائص WorkingHours:
- `dayOfWeek`: يوم الأسبوع
- `isOpen`: هل المتجر مفتوح
- `openTime`: وقت الفتح
- `closeTime`: وقت الإغلاق
- `hasBreak`: هل هناك استراحة
- `breakStartTime`: وقت بداية الاستراحة
- `breakEndTime`: وقت نهاية الاستراحة

#### الاستخدام:
```dart
// إنشاء ساعات عمل جديدة
WorkingHours dayHours = WorkingHours(
  dayOfWeek: 'السبت',
  isOpen: true,
  openTime: '09:00',
  closeTime: '18:00',
  hasBreak: true,
  breakStartTime: '12:00',
  breakEndTime: '13:00',
);

// إنشاء مواعيد عمل أسبوعية
WeeklyWorkingHours weeklyHours = WeeklyWorkingHours.empty();
weeklyHours.updateDayHours('السبت', dayHours);
```

### 3. واجهة المستخدم لاختيار مواعيد العمل
- **الملف**: `lib/widgets/working_hours_selector.dart`
- **المكونات**:
  - `WorkingHoursSelector`: المكون الرئيسي
  - `_DayWorkingHoursCard`: بطاقة يوم واحد
  - `_TimeField`: حقل إدخال الوقت

#### الاستخدام:
```dart
WorkingHoursSelector(
  initialWorkingHours: weeklyHours,
  onChanged: (WeeklyWorkingHours hours) {
    // تحديث مواعيد العمل
  },
  required: false,
)
```

### 4. تحديث نموذج المتجر
- **الملف**: `lib/markets/models/store_model.dart`
- **الإضافات**:
  - حقل `workingHours` من نوع `WeeklyWorkingHours?`
  - تحديث `fromMap()` و `toMap()` لدعم مواعيد العمل

### 5. تحديث ViewModel
- **الملف**: `lib/markets/viewmodels/create_store_viewmodel.dart`
- **الإضافات**:
  - حقل `workingHours`
  - دالة `setWorkingHours()`
  - استخدام `TimeService` في `createStore()`

### 6. تحديث صفحة إنشاء المتجر
- **الملف**: `lib/markets/pages/create_store_page.dart`
- **الإضافات**:
  - إضافة `WorkingHoursSelector` في النموذج
  - عرض مواعيد العمل في نافذة التأكيد

## كيفية الاستخدام

### 1. إضافة مواعيد العمل في صفحة إنشاء المتجر
1. افتح صفحة إنشاء المتجر
2. ستجد قسم "مواعيد العمل" بعد حقل رابط المتجر
3. لكل يوم من الأسبوع:
   - فعّل/ألغِ التفعيل باستخدام المفتاح
   - إذا كان مفتوحاً، حدد وقت الفتح والإغلاق
   - يمكن إضافة استراحة اختيارية

### 2. التحقق من صحة البيانات
- النظام يتحقق تلقائياً من صحة الأوقات المدخلة
- يجب أن يكون وقت الإغلاق بعد وقت الفتح
- الاستراحة يجب أن تكون داخل ساعات العمل

### 3. حفظ البيانات
- مواعيد العمل تُحفظ مع بيانات المتجر في Firebase
- يتم استخدام وقت السيرفر في جميع العمليات

## المميزات

### 1. دقة الوقت
- استخدام سيرفر خارجي بدلاً من ساعة الجهاز
- التحقق من صحة الوقت
- خيارات احتياطية متعددة

### 2. مرونة في المواعيد
- دعم الاستراحات
- دعم العمل لساعات متأخرة (مثل من 22:00 إلى 02:00)
- إمكانية إغلاق أيام معينة

### 3. واجهة مستخدم سهلة
- تصميم بديهي
- تحقق فوري من صحة البيانات
- دعم اللغة العربية

### 4. تكامل مع النظام
- حفظ في Firebase
- تحديث ViewModel
- عرض في نافذة التأكيد

## التبعيات المطلوبة

تم إضافة التبعية التالية في `pubspec.yaml`:
```yaml
dependencies:
  http: ^1.1.0
```

## ملاحظات مهمة

1. **الأمان**: تأكد من إضافة صلاحيات الإنترنت في `android/app/src/main/AndroidManifest.xml`
2. **الأداء**: الخدمة تستخدم timeout لتجنب التعليق
3. **الاحتياط**: في حالة فشل السيرفر، سيتم استخدام وقت الجهاز مع تحذير
4. **التحقق**: النظام يتحقق من صحة البيانات قبل الحفظ

## استكشاف الأخطاء

### مشاكل شائعة:
1. **فشل في الحصول على الوقت**: تحقق من الاتصال بالإنترنت
2. **خطأ في صحة البيانات**: تأكد من صحة تنسيق الأوقات
3. **مشاكل في الواجهة**: تأكد من استيراد المكونات بشكل صحيح

### رسائل الخطأ:
- "خطأ في WorldTimeAPI": فشل في الحصول على الوقت من المصدر الأساسي
- "خطأ في TimeAPI": فشل في الحصول على الوقت من المصدر الاحتياطي
- "تحذير: فشل في الحصول على الوقت من السيرفر": سيتم استخدام وقت الجهاز
