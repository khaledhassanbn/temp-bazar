# ุชูุฑูุฑ Cloud Functions - ุชุญููู ุงูุงุณุชุฎุฏุงู

## ุชุงุฑูุฎ ุงูุชูุฑูุฑ: 2025-12-23 (ูุญุฏูุซ)

---

## ููุฎุต

| ุงูุญุงูุฉ | ุงูุนุฏุฏ |
|--------|-------|
| โ ูุณุชุฎุฏูุฉ ูููุดูุฑุฉ | 8 |
| ๐ ุฏูุงู ูุฌุฏููุฉ (Scheduled) ุชุนูู ุชููุงุฆูุงู | 5 |
| โ๏ธ ุบูุฑ ูุณุชุฎุฏูุฉ ูู ุงูุชุทุจูู | 1 |

---

## ๐ ุชูุงุตูู ูู ุฏุงูุฉ

### 1๏ธโฃ ุงูุฏูุงู ุงููุฌุฏููุฉ (Scheduled Functions) - ุชุนูู ุชููุงุฆูุงู

| ุงูุฏุงูุฉ | ุงููุตู | ุงูุฌุฏูู ุงูุฒููู | ุงูุญุงูุฉ |
|--------|-------|---------------|--------|
| `checkExpiredSubscriptionsScheduled` | ูุญุต ุงูุงุดุชุฑุงูุงุช ุงูููุชููุฉ ูุชุนุทูููุง ุชููุงุฆูุงู | **ูู ุณุงุนุฉ** (0 * * * *) | โ ูุดุทุฉ |
| `autoRenewSubscriptionsScheduled` | ุชุฌุฏูุฏ ุชููุงุฆู ููุงุดุชุฑุงูุงุช ูุจู ุงูุชูุงุฆูุง ุจู 24 ุณุงุนุฉ (ุฅุฐุง ูุงู ุงูุชุฌุฏูุฏ ุงูุชููุงุฆู ููุนู ูููุฌุฏ ุฑุตูุฏ ูุงูู) | **ูู ุณุงุนุฉ** (0 * * * *) | โ ูุดุทุฉ |
| `licenseExpiryAlertsScheduled` | ุฅุฑุณุงู ุชูุจููุงุช ูููุชุงุฌุฑ ูุจู ุงูุชูุงุก ุงูุชุฑุฎูุต (1, 2, 3 ุฃูุงู) | **ููููุงู ุงูุณุงุนุฉ 8 ุตุจุงุญุงู** (0 8 * * *) | โ ูุดุทุฉ |
| `deleteExpiredAdsImagesScheduled` | ุญุฐู ุตูุฑ ุงูุฅุนูุงูุงุช ุงูููุชููุฉ ูู Storage | **ููููุงู ุงูุณุงุนุฉ 2 ุตุจุงุญุงู** (0 2 * * *) | โ ูุดุทุฉ |
| `cleanupExpiredPendingPaymentsScheduled` | ุชูุธูู ุงููุฏููุนุงุช ุงููุนููุฉ ุงูููุชููุฉ (ุฃูุซุฑ ูู 24 ุณุงุนุฉ) | **ูู ุณุงุนุฉ** (0 * * * *) | โ ูุดุทุฉ |

---

### 2๏ธโฃ ุงูุฏูุงู ุงููุงุจูุฉ ููุงุณุชุฏุนุงุก (Callable Functions) - โ ูุณุชุฎุฏูุฉ

| ุงูุฏุงูุฉ | ุงููุตู | ููุงู ุงูุงุณุชุฎุฏุงู ูู ุงูุชุทุจูู |
|--------|-------|---------------------------|
| `createPackageCallable` | ุฅูุดุงุก ุจุงูุฉ ุงุดุชุฑุงู ุฌุฏูุฏุฉ (Admin ููุท) | `lib/admin/packages/create_package_page.dart` |
| `updatePackageCallable` | ุชุญุฏูุซ ุจุงูุฉ ุงุดุชุฑุงู ููุฌูุฏุฉ (Admin ููุท) | `lib/admin/packages/manage_packages_page.dart` |
| `deletePackageCallable` | ุญุฐู ุจุงูุฉ ุงุดุชุฑุงู (Admin ููุท) | `lib/admin/packages/manage_packages_page.dart` |
| `renewStoreSubscriptionCallable` | ุชุฌุฏูุฏ ุงุดุชุฑุงู ูุชุฌุฑ ูู ููุญุฉ ุงูุฃุฏูู | `lib/admin/stores/services/stores_service.dart` |
| `addDaysToStoreSubscriptionCallable` | ุฅุถุงูุฉ/ุทุฑุญ ุฃูุงู ูู ุงุดุชุฑุงู ุงููุชุฌุฑ | `lib/admin/stores/services/stores_service.dart` |
| `suspendStoreSubscriptionCallable` | ุฅููุงู ุชุฑุฎูุต ุงููุชุฌุฑ | `lib/admin/stores/services/stores_service.dart` |

---

### 3๏ธโฃ ุฏูุงู HTTP (Webhook/Request)

| ุงูุฏุงูุฉ | ุงููุตู | ุงูุญุงูุฉ |
|--------|-------|--------|
| `paymobWebhookHandler` | ุงุณุชูุจุงู webhook ูู ุจูุงุจุฉ Paymob ุจุนุฏ ุงูุฏูุน | โ ูุณุชุฎุฏูุฉ (ุชุณุชูุจู ูู Paymob) |
| `facebookDataDeletionRequest` | ูุนุงูุฌุฉ ุทูุจุงุช ุญุฐู ุจูุงูุงุช ุงููุณุชุฎุฏู ูู Facebook | โ ูุทููุจุฉ ูุณูุงุณุฉ Facebook |

---

### 4๏ธโฃ โ๏ธ ุฏูุงู ุบูุฑ ูุณุชุฎุฏูุฉ ูู ุงูุชุทุจูู

| ุงูุฏุงูุฉ | ุงููุตู | ุงูุชูุตูุฉ |
|--------|-------|---------|
| `checkStoreStatusCallable` | ูุญุต ุญุงูุฉ ุงุดุชุฑุงู ุงููุชุฌุฑ | ุบูุฑ ูุณุชุฏุนุงุฉ ูู ุงูุชุทุจูู ุญุงููุงู - ูููู ุงุณุชุฎุฏุงููุง ูุงุญูุงู ุฃู ุญุฐููุง |

---

## ๐ ุชูุฑุงุฑ ุงูุชุดุบูู ููุฏูุงู ุงููุฌุฏููุฉ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโ
โ ุงูุฏุงูุฉ                                      โ ุงูุชูุฑุงุฑ               โ ูุฑุงุช/ููู       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโค
โ checkExpiredSubscriptionsScheduled          โ ูู ุณุงุนุฉ               โ 24 ูุฑุฉ         โ
โ autoRenewSubscriptionsScheduled             โ ูู ุณุงุนุฉ               โ 24 ูุฑุฉ         โ
โ cleanupExpiredPendingPaymentsScheduled      โ ูู ุณุงุนุฉ               โ 24 ูุฑุฉ         โ
โ licenseExpiryAlertsScheduled                โ ููููุงู 8 ุตุจุงุญุงู       โ 1 ูุฑุฉ          โ
โ deleteExpiredAdsImagesScheduled             โ ููููุงู 2 ุตุจุงุญุงู       โ 1 ูุฑุฉ          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโ

ุงูุฅุฌูุงูู: ~74 ุชุดุบูู ููููุงู = ~2,220 ุชุดุบูู ุดูุฑูุงู
```

---

## ๐ง ุงูุฅุตูุงุญุงุช ุงูุชู ุชูุช

### โ ุชู ุฅูุดุงุก ุงูุฏูุงู ุงูููููุฏุฉ:
1. **`addDaysToStoreSubscription.ts`** - ุฏุงูุฉ ูุฅุถุงูุฉ/ุทุฑุญ ุฃูุงู ูู ุงุดุชุฑุงู ุงููุชุฌุฑ
2. **`suspendStoreSubscription.ts`** - ุฏุงูุฉ ูุฅููุงู ุชุฑุฎูุต ุงููุชุฌุฑ

### โ ุชู ุชุณุฌูู ุงูุฏูุงู ูู `index.ts`:
- `addDaysToStoreSubscriptionCallable`
- `suspendStoreSubscriptionCallable`

### โ ุชู ุชุญุฏูุซ ุฃุณูุงุก ุงูุฏูุงู ูู ุงูุชุทุจูู:
- `stores_service.dart` - ุชุญุฏูุซ ุฃุณูุงุก ุงูุฏูุงู ูุชุชูุงูู ูุน ุงูุฃุณูุงุก ุงูุฌุฏูุฏุฉ

### โ ุชู ุฅุตูุงุญ ุฎุทุฃ ุงูุจูุงุก:
- ุฅุฒุงูุฉ ุงููุชุบูุฑ `now` ุบูุฑ ุงููุณุชุฎุฏู ูู `autoRenew.ts`

---

## ๐ฐ ุชูุฏูุฑ ุงูุชูุงููู ุงูุดูุฑูุฉ

ุจูุงุกู ุนูู ุฎุทุฉ Blaze (ุงูุฏูุน ุญุณุจ ุงูุงุณุชุฎุฏุงู):
- ุงูุฏูุงู ุงููุฌุฏููุฉ ุชุนูู **~74 ูุฑุฉ ููููุงู** = ~2,220 ูุฑุฉ ุดูุฑูุงู
- ูุน ุงูุฃุฎุฐ ุจุงูุงุนุชุจุงุฑ ุฃู ุฃูู 2 ููููู ุงุณุชุฏุนุงุก ูุฌุงููุฉ ุดูุฑูุงู
- **ุงูุชูููุฉ ุงููุชููุนุฉ: $0** (ุถูู ุงูุญุฏ ุงููุฌุงูู)

---

## ๐ ููุงุญุธุงุช ุฅุถุงููุฉ

1. ุฌููุน ุงูุฏูุงู ุชุนูู ูู ููุทูุฉ `europe-west1`
2. ุงูุฏูุงู ุงููุฌุฏููุฉ ุชุณุชุฎุฏู ุชูููุช ุงููุงูุฑุฉ `Africa/Cairo`
3. Webhook ุงูุฎุงุต ุจู Paymob ูุฌุจ ุชุณุฌูู ุงูู URL ูู ููุญุฉ ุชุญูู Paymob
4. ุฌููุน ุงูุฏูุงู ุงูุฅุฏุงุฑูุฉ ุชุชุทูุจ ุตูุงุญูุฉ Admin

---

## ๐ ูููู ูููุงุช ุงูุฏูุงู

```
functions/src/
โโโ index.ts                          # ุชุณุฌูู ุฌููุน ุงูุฏูุงู
โโโ subscriptions/
โ   โโโ checkExpired.ts               # ูุญุต ุงูุงุดุชุฑุงูุงุช ุงูููุชููุฉ
โ   โโโ checkStatus.ts                # ูุญุต ุญุงูุฉ ุงููุชุฌุฑ
โ   โโโ renewSubscription.ts          # ุชุฌุฏูุฏ ุงูุงุดุชุฑุงู (Admin)
โ   โโโ addDays.ts                    # ุฅุถุงูุฉ/ุทุฑุญ ุฃูุงู (Admin) โจ ุฌุฏูุฏ
โ   โโโ suspendSubscription.ts        # ุฅููุงู ุงูุชุฑุฎูุต (Admin) โจ ุฌุฏูุฏ
โ   โโโ autoRenew.ts                  # ุงูุชุฌุฏูุฏ ุงูุชููุงุฆู
โ   โโโ expiryAlerts.ts               # ุชูุจููุงุช ุงูุชูุงุก ุงูุชุฑุฎูุต
โโโ packages/
โ   โโโ crud.ts                       # ุฅุฏุงุฑุฉ ุงูุจุงูุงุช (CRUD)
โโโ paymob/
โ   โโโ webhook.ts                    # Webhook ุจูุงุจุฉ ุงูุฏูุน
โโโ ads/
โ   โโโ deleteExpiredImages.ts        # ุญุฐู ุตูุฑ ุงูุฅุนูุงูุงุช ุงูููุชููุฉ
โโโ pendingPayments/
โ   โโโ cleanupExpired.ts             # ุชูุธูู ุงููุฏููุนุงุช ุงููุนููุฉ
โโโ facebook/
โ   โโโ dataDeletion.ts               # ุญุฐู ุจูุงูุงุช Facebook
โโโ utils/
    โโโ auth.ts                       # ุงูุชุญูู ูู ุตูุงุญูุงุช Admin
```
