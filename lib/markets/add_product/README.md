# Add Product Module - MVVM Architecture

## نظرة عامة
تم تطوير وحدة إضافة المنتجات باستخدام نمط MVVM (Model-View-ViewModel) مع Firebase Firestore كقاعدة بيانات.

## البنية

### 1. Models (`models/product_models.dart`)
- **ProductCategoryModel**: نموذج فئات المنتجات
- **ProductOptionModel**: نموذج خيارات المنتج (مطلوبة أو إضافية)
- **ProductModel**: النموذج الرئيسي للمنتج مع جميع الحقول المطلوبة

### 2. Services (`services/product_service.dart`)
خدمة Firebase Firestore التي تدعم:
- إضافة/تحديث/حذف المنتجات
- إدارة الفئات
- رفع الصور إلى Firebase Storage
- البحث في المنتجات
- إدارة المخزون

### 3. ViewModel (`viewmodels/add_product_viewmodel.dart`)
يدير حالة التطبيق ويتضمن:
- إدارة بيانات النموذج
- التحقق من صحة البيانات
- إدارة الخيارات المطلوبة والإضافية
- إدارة الخصم والكمية
- إضافة فئات جديدة

### 4. View (`pages/add_product.dart`)
واجهة المستخدم التي تشمل:
- نموذج إضافة المنتج
- اختيار الصورة
- إدارة الخيارات
- إدارة الخصم والكمية
- رسائل الخطأ والنجاح

## الميزات الجديدة

### 1. إدارة الخصم
- تفعيل/إلغاء تفعيل الخصم
- حساب السعر النهائي تلقائياً
- عرض السعر النهائي للمستخدم

### 2. إدارة الكمية
- تفعيل/إلغاء تفعيل حد الكمية
- تحديد عدد القطع المتاحة
- إدارة المخزون

### 3. الخيارات المطلوبة والإضافية
- إضافة خيارات مطلوبة من العميل
- إضافة خيارات إضافية غير مطلوبة
- إدارة قائمة الخيارات لكل منتج

### 4. إدارة الفئات
- إضافة فئات جديدة ديناميكياً
- ربط المنتجات بالفئات المناسبة

### 5. رفع الصور
- اختيار الصور من المعرض
- ضغط الصور قبل الرفع
- رفع الصور إلى Firebase Storage

## بنية قاعدة البيانات

```
markets/{marketId}/products/{categoryId}/items/{productId}
```

### حقول المنتج:
- `name`: اسم المنتج
- `price`: السعر الأصلي
- `description`: وصف المنتج
- `image`: رابط الصورة
- `stock`: كمية المخزون
- `hasStockLimit`: هل يوجد حد للكمية
- `hasDiscount`: هل يوجد خصم
- `discountValue`: قيمة الخصم
- `finalPrice`: السعر النهائي
- `requiredOptions`: الخيارات المطلوبة
- `extraOptions`: الخيارات الإضافية
- `createdAt`: تاريخ الإنشاء
- `updatedAt`: تاريخ التحديث

## الاستخدام

```dart
// في الصفحة الرئيسية
Provider<AddProductViewModel>(
  create: (_) => AddProductViewModel(),
  child: AddProductModernPage(),
)

// استخدام ViewModel
final vm = context.read<AddProductViewModel>();
await vm.addProduct();
```

## التحقق من صحة البيانات
- اسم المنتج مطلوب
- السعر يجب أن يكون أكبر من صفر
- إذا تم تفعيل حد الكمية، يجب تحديد كمية صحيحة
- إذا تم تفعيل الخصم، يجب تحديد قيمة خصم صحيحة

## معالجة الأخطاء
- عرض رسائل الخطأ للمستخدم
- معالجة أخطاء الشبكة
- التحقق من صحة البيانات قبل الإرسال